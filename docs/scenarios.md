# Сценарии использования (Flow of Events)

На основе SRS.md (3.1.1, 2.2). Для каждого UC: Введение, Основной поток, Альтернативы, Исключения. Учитываем GUI (мокапы), обработку ошибок.

## UC1: Manage Pantry
**Введение**: Актеры: User (primary). Предусловие: User на экране "Кладовая" (pantry_screen.png: таблица с продуктами). Постусловие: Pantry обновлена в SQLite (3.2.1.3). GUI: кнопки "Добавить/Удалить/Редактировать", форма (name, quantity).

**Основной поток**:
  1. User нажимает "Добавить продукт".
  2. System открывает форму (модальное окно: поля "Название", "Количество", единица).
  3. User вводит данные (напр. "Молоко", 1.5, "л").
  4. User нажимает "Сохранить".
  5. System валидирует (quantity > 0), добавляет в Pantry (SQLite insert).
  6. System обновляет таблицу и показывает "Продукт добавлен".

**Альтернативы**:
  - 1a: User выбирает продукт и нажимает "Редактировать" → открытие модала с текущими данными → шаги 3–6 (update вместо insert).
  - 1b: User нажимает "Удалить" для продукта → диалог подтверждения → удаление из таблицы/SQLite (шаг 5: delete).

**Исключения**:
  - 3a: Invalid input (empty name или quantity < 0) → "Неверные данные" (красная подсветка), возврат к шагу 3.
  - 5a: Ошибка SQLite (3.2.1.3) → "Ошибка сохранения", возврат к шагу 1 без изменений.

## UC2: Search Recipes
**Введение**: Актеры: User, Spoonacular API (secondary, 2.1). Предусловие: User на главном экране (main_screen.png) или "Рецепты". Постусловие: Список рецептов отображён. GUI: чекбоксы ингредиентов, кнопка "Найти", список с имеющимися/недостающими (recipes_screen.png). Время <3 сек (3.2.1.2).

**Основной поток**:
  1. User вводит/выбирает ингредиенты (чекбоксы).
  2. User нажимает "Найти рецепты".
  3. System получает список из Pantry (если выбрано).
  4. System формирует query и отправляет REST в API (JSON: ingredients=list).
  5. API возвращает рецепты.
  6. System сравнивает с Pantry, маркирует (имеющиеся/недостающие), отображает список (название, шаги, кнопки "В избранное").

**Альтернативы**:
  - 1a: User выбирает "По кладовой" → авто-заполнение из Pantry.
  - 6a: User кликает "В избранное" для рецепта → переход к UC4.

**Исключения**:
  - 4a: API недоступен (лимит 150/день или нет интернета, 3.2.3) → "Нет соединения", fallback на локальные Favorites.
  - 1a: Empty query → "Введите ингредиент".

## UC3: Generate Shopping List
**Введение**: Актеры: User. Предусловие: Recipe выбран из UC2. Постусловие: ShoppingList сгенерирована. GUI: чек-лист (shopping_list.png: галочки, кнопка "Добавить свой").

**Основной поток**:
  1. User кликает "Создать список покупок" для Recipe.
  2. System сравнивает required ingredients с Pantry.
  3. System генерирует missing list (diff quantity), отображает чек-лист.
  4. User отмечает галочку "Куплено" для items.
  5. System обновляет статус (local storage).

**Альтернативы**:
  - 4a: User нажимает "Добавить свой продукт" → форма ввода → добавление в additional (обновление шага 3).

**Исключения**:
  - 2a: Pantry пуста → "Заполните кладовую".
  - 3a: Нет недостающих → "Список пуст".

## UC4: Manage Recipes
**Введение**: Актеры: User. Предусловие: На экране добавления/избранного (add_recipe_screen.png, favorites_recipes_screen.png). Постусловие: Recipe сохранена/обновлена в SQLite.

**Основной поток**:
  1. User нажимает "Добавить рецепт" или выбирает из поиска.
  2. System открывает форму (title, ingredients list с qty, steps).
  3. User вводит данные.
  4. User сохраняет.
  5. System валидирует и сохраняет в Favorites/SQLite.
  6. System показывает обновлённый список.

**Альтернативы**:
  - 1a: Save from UC2 → копирование данных API в форму.
  - 6a: Edit в избранном → модал с текущими steps/ingredients.

**Исключения**:
  - 3a: Invalid data (empty steps) → "Заполните шаги".
  - 5a: SQLite error → "Не сохранено".

## UC5: Navigate Screens
**Введение**: Актеры: User. Предусловие: Приложение открыто. Постусловие: Экран сменён без потери данных. GUI: Кнопки "Назад"/меню (все мокапы).

**Основной поток**:
  1. User кликает кнопку навигации (напр. "Кладовая" на main_screen.png).
  2. System сохраняет текущее состояние (если нужно).
  3. System переходит к новому экрану (<2 сек, 3.2.1.2).

**Альтернативы**:
  - 1a: "Назад" → возврат с сохранением формы.

**Исключения**:
  - 3a: Ошибка рендера → авто-reload страницы.